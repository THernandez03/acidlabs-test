!function(e){function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="https://acidlabs-test.herokuapp.com/assets/",t(t.s=1)}([function(e,t){e.exports=require("babel-runtime/helpers/defineProperty")},function(e,t,r){"use strict";(function(e){function t(e){return e&&e.__esModule?e:{default:e}}var n=r(3),u=t(n),a=r(4),o=t(a),s=r(5),c=t(s),i=r(6),l=t(i),f=r(7),d=t(f),p=r(0),b=t(p),v=r(8),h=t(v),_=r(9),x=t(_),m=r(10),k=t(m),w=r(11),y=t(w),q=r(12),g=t(q),j=r(13),S=r(14),T=t(S),C=r(15),E=t(C),O=r(16),P=t(O),M=r(17),A=t(M),R=r(18),G=t(R),L=r(23),D=(0,j.readFileSync)("./public/server/views/index.html","utf8"),H=E.default.createClient(L.redisUrl),F=(0,A.default)({path:"./public/app/",url:"/assets"}),N=function t(){try{if(Math.random()<.1)throw new G.default("How unfortunate! The API Request Failed");return e("http://finance.google.com/finance/info?client=ig&q="+L.supportedStocks.join(),{headers:{"Content-Type":"text/plain"},method:"GET"}).then(function(e){return e.text()}).then(function(e){return JSON.parse(e.slice(4))})}catch(e){var r=e.isRandom;r&&(console.log("Retrying..."),t())}},U=function(e){return(0,y.default)(x.default.mark(function t(){var r;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=[];case 5:return r=t.t0,r.forEach(function(e){var t=e.t,r=e.lt_dts,n=Math.round(+new Date(r)/1e3);H.hset(t,n,(0,k.default)(e))}),t.abrupt("return",r);case 8:case"end":return t.stop()}},t,void 0)}))},I=function(e){var t={};return(0,y.default)(x.default.mark(function r(){var n,a;return x.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e();case 2:return n=r.sent,a=(0,c.default)(n).filter(function(e){var r=(0,o.default)(e,2),n=r[0],u=r[1].value;return(t[n]||{}).value!==u}).reduce(function(e,t){var r=(0,o.default)(t,2),n=r[0],u=r[1];return(0,h.default)({},e,(0,b.default)({},n,u))},{}),t=n,r.abrupt("return",{isChanged:!!(0,u.default)(a).length,data:a});case 6:case"end":return r.stop()}},r,void 0)}))},J=function(e){return(0,y.default)(x.default.mark(function t(){var r;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return r=t.sent,t.abrupt("return",r.reduce(function(e,t){var r=t.t,n=t.l,u=t.lt_dts;return(0,h.default)({},e,(0,b.default)({},r,{value:n,date:u}))},{}));case 4:case"end":return t.stop()}},t,void 0)}))}(U(N)),V=function(e){return function(t){return new d.default(function(){var r=(0,y.default)(x.default.mark(function r(n,u){return x.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e();case 2:H.hgetall(t,function(e,t){return e?u(new Error(e)):n((0,l.default)(t).reduce(function(e,t){var r=JSON.parse(t),n=(r.t,r.l),u=r.lt_dts;return(0,h.default)({},e,(0,b.default)({},u,n))},{}))});case 3:case"end":return r.stop()}},r,void 0)}));return function(e,t){return r.apply(this,arguments)}}())}}(U(N)),z=function(){var e=(0,P.default)().utc(),t=e.hours(),r=e.minutes();return{status:!!(t>14&&r>30&&t<21)}},B=g.default.createServer(function(){var e=(0,y.default)(x.default.mark(function e(t,r){var n,u,a,s,c,i;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.method,u=t.url,a=u.split("/").slice(1),s=(0,o.default)(a,2),c=s[0],i=s[1],"GET"!==n||!i||!L.supportedStocks.includes(i)){e.next=13;break}return r.writeHead(200,{"Content-Type":"application/json"}),e.t0=r,e.t1=k.default,e.next=8,V(i);case 8:e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t0.end.call(e.t0,e.t3),e.next=25;break;case 13:if("GET"!==n||"getStocks"!==c){e.next=24;break}return r.writeHead(200,{"Content-Type":"application/json"}),e.t4=r,e.t5=k.default,e.next=19,J();case 19:e.t6=e.sent,e.t7=(0,e.t5)(e.t6),e.t4.end.call(e.t4,e.t7),e.next=25;break;case 24:"GET"===n&&"getStockStatus"===c?(r.writeHead(200,{"Content-Type":"application/json"}),r.end((0,k.default)(z()))):"GET"===n&&"assets"===c?F(t,r):(r.writeHead(200,{"Content-Type":"text/html"}),r.end(D));case 25:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()),K=(0,T.default)(B),Q=(0,o.default)(process.argv,3),W=Q[2],X=void 0===W?3e3:W;console.log(X),B.listen(X,(0,y.default)(x.default.mark(function e(){var t,r;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Server listening on "+X),t=z().status,r=I(J),e.next=5,r();case 5:setInterval((0,y.default)(x.default.mark(function e(){var n,u,a,o,s;return x.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r();case 2:n=e.sent,u=n.isChanged,a=n.data,o=z(),s=o.status,u&&K.sockets.emit("updateStocks",a),s!==t&&(t=s,K.sockets.emit("updateStockStatus",s));case 8:case"end":return e.stop()}},e,void 0)})),2500);case 6:case"end":return e.stop()}},e,void 0)})))}).call(t,r(2))},function(e,t){e.exports=require("fetch-everywhere")},function(e,t){e.exports=require("babel-runtime/core-js/object/keys")},function(e,t){e.exports=require("babel-runtime/helpers/slicedToArray")},function(e,t){e.exports=require("babel-runtime/core-js/object/entries")},function(e,t){e.exports=require("babel-runtime/core-js/object/values")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("babel-runtime/helpers/extends")},function(e,t){e.exports=require("babel-runtime/regenerator")},function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("redis")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("st")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=r(19),a=n(u),o=r(20),s=n(o),c=r(21),i=n(c),l=r(22),f=n(l),d=function(e){function t(e){(0,s.default)(this,t);var r=(0,i.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));return r.name=r.constructor.name,r.isRandom=!0,"function"==typeof Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=new Error(e).stack,r}return(0,f.default)(t,e),t}(Error);t.default=d},function(e,t){e.exports=require("babel-runtime/core-js/object/get-prototype-of")},function(e,t){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,t){e.exports=require("babel-runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("babel-runtime/helpers/inherits")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.redisUrl=t.supportedStocks=t.assets=t.url=void 0;var n=r(0),u=function(e){return e&&e.__esModule?e:{default:e}}(n),a=r(24),o=t.url=a.__PROD__?"https://acidlabs-test.herokuapp.com":"http://localhost:3000";t.assets=(0,u.default)({},a.__LOCAL__,"http://127.0.0.1:4000").true||o+"/assets",t.supportedStocks=["AAPL","ABC","MSFT","TSLA","F"],t.redisUrl=a.__PROD__?"redis://h:pce6511fb91bfddb13557e929f990d1730aef2d556843f41e924a77be509ea4f7@ec2-34-231-155-48.compute-1.amazonaws.com:30739":""},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="production",u=t.__PROD__="production"===n,a=t.__STAGE__="stage"===n,o=t.__DEV__="development"===n;u||a||o||(n="local");t.__LOCAL__="local"===n,t.__ENV__=n}]);